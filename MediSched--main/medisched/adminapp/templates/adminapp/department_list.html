{% extends 'adminapp/base_admin.html' %}
{% load static %}

{% block title %}Manage Departments | MediSched Admin{% endblock %}

{% block content %}
<div class="container mt-5">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3><i class="fa-solid fa-building me-2"></i> Manage Departments</h3>
  </div>

  <!-- Add Department Form -->
  <div class="card p-4 mb-4">
    <form method="POST" action="{% url 'add_department' %}" class="row g-3" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="col-md-5">
        <input type="text" name="department_name" class="form-control" placeholder="New Department Name" required>
      </div>
      <div class="col-md-5">
        <input type="file" name="department_image" class="form-control" accept="image/*">
      </div>
      <div class="col-md-2 d-grid">
        <button class="btn btn-success"><i class="fa-solid fa-plus me-2"></i>Add</button>
      </div>
    </form>
  </div>

  <!-- Department Table -->
  <div class="card p-4">
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead class="table-dark">
          <tr>
            <th>#ID</th>
            <th>Image</th>
            <th>Department Name</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for dept in departments %}
          <tr>
            <td>{{ dept.id }}</td>
            <td>
              {% if dept.department_image %}
                <img src="{{ dept.department_image.url }}" 
                     alt="{{ dept.department_name }}" 
                     class="table-img">
              {% else %}
                <span class="text-muted">No Image</span>
              {% endif %}
            </td>
            <td>{{ dept.department_name }}</td>
            <td>
              <div class="d-flex gap-2">
                <a href="{% url 'edit_department' dept.id %}" class="btn btn-primary btn-sm">
                  <i class="fa-solid fa-pen-to-square"></i> Edit
                </a>
                <a href="{% url 'delete_department' dept.id %}" class="btn btn-danger btn-sm">
                  <i class="fa-solid fa-trash"></i> Delete
                </a>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="4" class="text-center text-muted">No departments found. Add a new department above.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Inline CSS for images -->
<style>
.table-img {
    width: 60px;
    height: 60px;
    object-fit: cover; /* maintain aspect ratio and fill */
    border-radius: 8px;
    border: 1px solid #dee2e6;
}
</style>
{% endblock %}
